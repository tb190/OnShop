@model List<ProductModel>
    @{
    ViewData["Title"] = "Vendor Products Page";
    Layout = "~/Views/Shared/_LayoutVendor.cshtml";
    }

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>@ViewData["Title"] - OnShop</title>
        <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
        <link rel="stylesheet" href="~/OnShop.styles.css" asp-append-version="true" />
        <script src="~/lib/jquery/dist/jquery.min.js"></script>
        <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    </head>
    <body>
        <div class="">

            <div class="row mt-3">
                <div class="d-flex justify-content-between mt-3">
                    <div class="btn-group-All-Online" role="group" aria-label="Product Status">
                        <button type="button" class="btn btn-outline-secondary" data-status="all">All</button>
                        <button type="button" class="btn btn-outline-secondary" data-status="online">Online</button>
                    </div>
                    <a class="btn btn-outline-secondary ml-auto" asp-area="" asp-controller="Vendor" asp-action="VendorAddNewProduct" role="button" style="width:200px;">Add New Product</a>
                </div>
            </div>

            <div class="row mt-2 d-flex justify-content-between align-items-center">
                <div class="col-md-3">
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchInput" placeholder="Search Products" aria-label="Search Products" aria-describedby="button-search" value="@ViewBag.SearchString">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" id="button-search">Search</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 d-flex justify-content-end">
                    <button class="btn btn-outline-secondary" type="button" style="margin-right:3px">Filter</button>
                    <button class="btn btn-outline-secondary" type="button">Reset</button>
                </div>
            </div>


            <div class="row mt-3">
                <div class="col">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Photos</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Rating</th>
                                <th>Favorites</th>
                                <th>Created At</th>
                                <th>Status</th>
                                <th>Reviews</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var product in Model)
                        {
                            var carouselId = "carousel" + product.ProductId; // Each product should have a unique ID

                            <tr class="product-row" data-status="@product.Status">
                                <td>
                                    <div style="width: 5rem; height: 7rem; overflow: hidden;">
                                        <div id="@carouselId" class="carousel slide" data-ride="carousel" style="max-width: 100%; max-height: 100%; ">
                                            <ol class="carousel-indicators">
                                                @if (product.Photos != null)
                                            {
                                                for (int i = 0; i < product.Photos.Count; i++)
                                                {
                                                <li data-bs-target="#@carouselId" data-bs-slide-to="@i" class="@((i == 0) ? "active" : "")"></li>
                                                }
                                            }
                                            </ol>
                                            <div class="carousel-inner">
                                                @if (product.Photos != null)
                                            {
                                                for (int i = 0; i < product.Photos.Count; i++)
                                                {
                                                <div class="carousel-item @(i == 0 ? "active" : "")">
                                                    <img class="d-block w-100" src="@product.Photos.ElementAt(i)" alt="Slide @(i + 1)">
                                                </div>
                                                }
                                            }
                                            </div>
                                            <button class="carousel-control-prev" type="button" data-bs-target="#@carouselId" data-bs-slide="prev">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Previous</span>
                                            </button>
                                            <button class="carousel-control-next" type="button" data-bs-target="#@carouselId" data-bs-slide="next">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Next</span>
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <td>@product.ProductName</td>
                                <td>@product.Description</td>
                                <td>@product.Category</td>
                                <td>@product.Price.ToString("C")</td>
                                <td>@product.Stock</td>
                                <td>
                                    <span class="rating">
                                        @for (int i = 0; i < 5; i++)
                                        {
                                            if (i < product.Rating)
                                            {
                                        <i class="las la-star" style="color: gold;"></i>
                                            }
                                            else
                                            {
                                        <i class="las la-star" style="color: #ccc;"></i>
                                            }
                                        }
                                    </span>
                                    <span>@product.Rating</span>
                                </td>
                                <td>
                                    <span class="favorites">
                                        <i class="las la-heart" style="color: red;"></i> @product.Favorites
                                    </span>
                                </td>
                                <td>
                                    @if (product.Status == "Online")
                                    {
                                    <span>Online</span>
                                    <span class="status-online"></span>
                                    }
                                    else
                                    {
                                    <span>Offline</span>
                                    <span class="status-offline"></span>
                                    }
                                </td>
                                <td>@product.CreatedAt.ToString("yyyy-MM-dd HH:mm:ss")</td>
                                <td>
                                    <button type="button" class="btn btn-sm" data-toggle="modal" data-target="#reviewModal">
                                        <i class="las la-comment-dots"></i> Open Reviews
                                    </button>

                                    <!-- Modal -->
                                    <div class="modal fade" id="reviewModal" tabindex="-1" role="dialog" aria-labelledby="reviewModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="reviewModalLabel">Product Reviews</h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    @foreach (var review in product.ProductReviews)
                                                    {
                                                    <div class="mb-2" style="border-bottom: 1px solid #959d90">
                                                        <!-- Example of review type or other details -->
                                                        <span>@review</span> <!-- Review content -->
                                                    </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>

                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Paging -->
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    @if (ViewBag.CurrentPage > 1)
        {
                    <li class="page-item">
                        <a class="page-link" asp-action="VendorProducts" asp-route-page="1" asp-route-searchString="" aria-label="Go to First Page">
                            <span aria-hidden="true">&laquo;&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" asp-action="VendorProducts" asp-route-page="@(ViewBag.CurrentPage - 1)" asp-route-searchString="" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
        }
                    @if (ViewBag.TotalPages > 5 && ViewBag.CurrentPage > 3)
        {
                    <li class="page-item">
                        <a class="page-link" asp-action="VendorProducts" asp-route-searchString="" asp-route-page="1">1</a>
                    </li>
                    <li class="page-item disabled">
                        <a class="page-link">...</a>
                    </li>
        }
                    @for (var i = Math.Max(1, ViewBag.CurrentPage - 2); i <= Math.Min(ViewBag.TotalPages, ViewBag.CurrentPage + 2); i++)
        {
                    <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                        <a class="page-link" asp-action="VendorProducts" asp-route-searchString="" asp-route-page="@i">@i</a>
                    </li>
        }
                    @if (ViewBag.TotalPages > 5 && ViewBag.CurrentPage < ViewBag.TotalPages - 2)
        {
                    <li class="page-item disabled">
                        <a class="page-link">...</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" asp-action="VendorProducts" asp-route-searchString="" asp-route-page="@ViewBag.TotalPages">@ViewBag.TotalPages</a>
                    </li>
        }
                    @if (ViewBag.CurrentPage < ViewBag.TotalPages)
        {
                    <li class="page-item">
                        <a class="page-link" asp-action="VendorProducts" asp-route-searchString="" asp-route-page="@(ViewBag.CurrentPage + 1)" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" asp-action="VendorProducts" asp-route-searchString="" asp-route-page="@ViewBag.TotalPages" aria-label="Go to Last Page">
                            <span aria-hidden="true">&raquo;&raquo;</span>
                        </a>
                    </li>
        }
                </ul>
            </nav>


        </div>

        <style>
            /*.btn-group-All-Online .btn {
                font-weight: bold;
            }

                .btn-group-All-Online .btn:hover {
                    color: rgba(0,0,0,.45);
                }*/

            .status-online {
                display: inline-block;
                width: 10px;
                height: 10px;
                background-color: green;
                border-radius: 50%;
            }

            .status-offline {
                display: inline-block;
                width: 10px;
                height: 10px;
                background-color: dimgrey;
                border-radius: 50%;
            }

            .table-striped tbody tr:nth-of-type(odd) {
                background-color: rgba(0,0,0,.05);
            }

            .table-hover tbody tr:hover {
                background-color: rgba(0,0,0,.075);
            }

            .carousel-item {
                height: 100%;
                overflow: hidden;
                width: 100%;
            }

                .carousel-item img {
                    width: 100%;
                    overflow: hidden;
                }

        </style>

        <script>

            // --------------------------------- Carousel ---------------------------------
            $(document).ready(function () {
                $('.carousel').carousel();
            });

            // --------------------------------- Open or Close Modal ---------------------------------

            $(document).ready(function () {
                $('.btn[data-toggle="modal"]').on('click', function () {
                    var targetModal = $(this).data('target');
                    $(targetModal).modal('show');
                });
            });
            $(document).ready(function () {
                $(document).on('click', '[data-dismiss="modal"]', function () {
                    var targetModal = $(this).closest('.modal');
                    $(targetModal).modal('hide');
                });
            });

            // --------------------------------- All or Online ---------------------------------
            $(document).ready(function () {
                // Initial table setup
                $('.product-row').show(); // Show all rows initially

                // Handle showing only online products
                $('.btn-outline-secondary[data-status="online"]').on('click', function () {
                    $('.product-row').each(function () {
                        var rowStatus = $(this).data('status');
                        if (rowStatus === 'Online') {
                            $(this).show(); // Show online rows
                        } else {
                            $(this).hide(); // Hide offline rows
                        }
                    });
                });

                // Handle showing all products
                $('.btn-outline-secondary[data-status="all"]').on('click', function () {
                    $('.product-row').show(); // Show all rows
                });
            });

            // --------------------------------- Search ---------------------------------
            $(document).ready(function () {
                // Handle search functionality
                $('#button-search').on('click', function () {
                    var searchString = $('#searchInput').val().toLowerCase().trim();

                    // Redirect to the action with updated search string
                    window.location.href = '@Url.Action("VendorProducts", "Vendor")' + '?searchString=' + searchString;
                });

                // Optionally, handle search on Enter key press
                $('#searchInput').keypress(function (e) {
                    if (e.which === 13) { // 13 is the Enter key code
                        $('#button-search').click();
                    }
                });
            });



        </script>
    </body>
</html>
